<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title>GanhaPlus â€” Painel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <meta name="description" content="GanhaPlus â€” Painel de tarefas. Acompanhe o saldo, veja anÃºncios e compartilhe links para ganhar Kwanzas.">
</head>

<body class="theme-dark dashboard-page" data-page="principal">

  <!-- HEADER -->
  <header class="site-header">
    <button id="toggle-sidebar" class="btn-hamburger" aria-label="Abrir menu">
      <span></span><span></span><span></span>
    </button>

    <div class="header-title">
      <h1>GanhaPlus</h1>
    </div>

    <div class="header-actions">
      <div class="saldo">
        <small>Saldo</small>
        <div id="saldo-valor">0 AOA</div>
      </div>
      <button id="btn-logout" class="btn-ghost">Sair</button>
    </div>
  </header>

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2 class="brand">GanhaPlus</h2>
      <span class="tag">Menu</span>
    </div>

    <nav class="menu">
      <a href="principal.html" class="menu-item active">ğŸ  Painel</a>
      <a href="tarefa.html" class="menu-item">ğŸ¯ Tarefas</a>
      <a href="historico.html" class="menu-item">ğŸ“œ HistÃ³rico</a>
      <a href="saque.html" class="menu-item">ğŸ’¸ Saque</a>
    </nav>

    <div class="sidebar-footer">
      <button id="btn-logout-2" class="logout-btn">Sair</button>
      <small class="muted">VersÃ£o 7.0</small>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main-content">
    <header class="topbar">
      <h2>Painel</h2>
      <p class="subtitle">Acompanhe seu saldo e realize tarefas para ganhar Kwanzas</p>
    </header>

    <section class="section-block">
      <h3 class="section-title">Tarefas RÃ¡pidas</h3>
      <p class="subtitle">Ganhe Kwanzas completando tarefas simples</p>

      <div class="tarefas-grid">

        <!-- Assistir -->
        <article class="tarefa-card">
          <div class="tarefa-card-body">
            <h4>Assistir VÃ­deos</h4>
            <p>+500 AOA por anÃºncio (4 anÃºncios por vÃ­deo)</p>
          </div>
          <div class="tarefa-card-actions">
            <button id="btn-assistir" class="btn-primary">Assistir</button>
          </div>
        </article>

        <!-- Compartilhar -->
        <article class="tarefa-card">
          <div class="tarefa-card-body">
            <h4>Compartilhar Link</h4>
            <p>+500 AOA por compartilhamento</p>
          </div>
          <div class="tarefa-card-actions">
            <button id="btn-compartilhar" class="btn-primary">Compartilhar</button>
          </div>
        </article>

      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script src="app.js" defer></script>

  <script defer>
    document.addEventListener("DOMContentLoaded", () => {

      /* ====== SIDEBAR ====== */
      const toggleBtn = document.getElementById("toggle-sidebar");
      const sidebar = document.getElementById("sidebar");

      toggleBtn?.addEventListener("click", () => {
        sidebar.classList.toggle("sidebar-hidden");
        toggleBtn.classList.toggle("active");
      });

      /* ====== LOGOUT ====== */
      const logout = () => {
        localStorage.removeItem("gp_token");
        window.location.href = "login.html";
      };

      [document.getElementById("btn-logout"), document.getElementById("btn-logout-2")]
        .forEach(btn => btn?.addEventListener("click", logout));

      /* ====== VERIFICAR TOKEN ====== */
      const token = localStorage.getItem("gp_token");
      if (!token) return logout();

      /* ====== CARREGAR SALDO ====== */
      if (typeof carregarPainel === "function") carregarPainel();

      /* ====== BOTÃ•ES DE TAREFAS ====== */
      const btnAssistir = document.getElementById("btn-assistir");
      const btnCompartilhar = document.getElementById("btn-compartilhar");

      /* ------- Assistir VÃ­deos ------- */
      btnAssistir?.addEventListener("click", async () => {
        if (btnAssistir.disabled) return;

        btnAssistir.disabled = true;
        btnAssistir.innerText = "Aguarde...";

        try {
          if (typeof abrirSequenciaAnuncios !== "function")
            return alert("Erro interno: FunÃ§Ã£o de anÃºncios nÃ£o encontrada.");

          const ok = await abrirSequenciaAnuncios();
          if (!ok) alert("NÃ£o hÃ¡ anÃºncios disponÃ­veis no momento.");

          if (typeof carregarPainel === "function") carregarPainel();

        } catch (err) {
          console.error(err);
          alert("Erro ao assistir anÃºncios. Tente novamente.");
        }

        btnAssistir.disabled = false;
        btnAssistir.innerText = "Assistir";
      });

      /* ------- Compartilhar Link ------- */
      btnCompartilhar?.addEventListener("click", async () => {
        if (btnCompartilhar.disabled) return;

        btnCompartilhar.disabled = true;
        btnCompartilhar.innerText = "Aguarde...";

        try {
          if (typeof compartilhar !== "function")
            return alert("Erro interno: FunÃ§Ã£o de partilha nÃ£o encontrada.");

          const ok = await compartilhar();
          if (!ok) alert("Falha ao registrar partilha. Tente novamente.");

          if (typeof carregarPainel === "function") carregarPainel();

        } catch (err) {
          console.error(err);
          alert("Erro ao compartilhar o link.");
        }

        btnCompartilhar.disabled = false;
        btnCompartilhar.innerText = "Compartilhar";
      });
    });
  </script>

</body>
</html>
